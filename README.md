# TypeTracer - Mac 打字追踪应用

TypeTracer 是一款 macOS 平台的本地打字追踪工具。它适合需要了解和回顾自己每日打字与输入习惯的用户。应用可后台运行，通过菜单栏图标常驻，即使主窗口被关闭，系统依然会自动统计你的按键信息。

应用主要设计目标是帮助你随时了解过去一分钟、一小时，以及当天的打字数量，并以清晰的界面进行统计展示。所有数据会持续保存，并可随时回顾最近七天的历史情况，无需担心数据重启丢失。TypeTracer 不会记录具体按键内容，仅记录数量，保护你的隐私。

软件实现基于 Swift 5 和 SwiftUI，主要分为键盘事件监听、统计模型和可视化界面三部分。全局键盘监听使用 macOS 辅助功能 API，能够精准捕获你的击键行为。统计模型部分会自动存储每次击键时间，并周期性统计近一分钟、一小时、全天，及最近一周的击键数和分布情况。应用界面则为你直观呈现三项核心统计和今日按小时的柱状图，并可以方便地浏览历史记录。

应用的核心组件包括 KeyboardMonitor.swift 负责监听全局键盘事件，使用 macOS Accessibility API 过滤修饰键并只统计实际字符输入。TypingStatistics.swift 管理统计数据，记录每次按键的时间戳，计算不同时间段的统计，使用 UserDefaults 持久化存储，并自动清理七天以前的旧数据。ContentView.swift 提供用户界面，包含实时统计页面显示三个统计卡片和每小时柱状图，历史数据页面显示最近七天的数据对比，以及控制面板用于启动停止监控、清除数据和权限管理。TypeTracer.entitlements 配置应用权限，禁用 App Sandbox 以允许全局键盘事件监听。

应用的工作原理是首先获取辅助功能权限，这是监听全局键盘事件的必要条件。然后通过 NSEvent.addGlobalMonitorForEvents 监听键盘按下事件，每次按键时记录时间戳到数组中。系统每秒更新一次统计数据，通过过滤时间戳计算不同时间段的按键数。最后将时间戳数组保存到 UserDefaults，应用重启后自动加载。

首次运行 TypeTracer，你需要授予辅助功能权限。主界面提供了跳转入口，按照提示即可在系统「隐私与安全性→辅助功能」页面手动添加和勾选 TypeTracer。一旦授权，应用就会在后台自动统计所有击键。

在 Xcode 打开本项目并运行后，窗口下方可主动清空现有数据。你还可以随时将窗口隐藏到菜单栏，仅靠顶部系统栏的图标和菜单完成所有操作。菜单栏图标会实时更新最近一分钟的打字数，点击图标可以查看更多详细数据及快速切换监控、退出等操作。

应用的主界面分为顶部状态栏、中间标签切换区域和底部控制栏。顶部状态栏显示 TypeTracer 标题和监控状态指示器，绿色圆点表示正在监控，红色圆点表示未启动，同时显示自开始记录以来的总按键数量。中间使用分段控制器切换两个视图，实时统计页面查看当前的打字数据，历史数据页面查看过去七天的数据对比。实时统计页面显示三个彩色统计卡片，分别展示最近一分钟、最近一小时和今日的按键数，以及每小时统计图表以柱状图形式实时显示今天每个小时的打字量。历史数据页面显示最近七天的打字统计，每一行包含日期、可视化条形图和具体数字，数据按日期降序排列。底部控制栏包含请求辅助功能权限按钮、清除数据按钮和开始停止监控按钮。

数据更新频率为每秒更新一次，数据存储期限为自动保存最近七天的数据，数据存储位置在 UserDefaults 应用沙盒内，重启应用后数据会自动恢复。

TypeTracer 的所有数据仅保存在本地 UserDefaults，不会进行网络同步或上传，保证使用过程中的个人隐私安全。应用只统计按键次数，不记录具体按键内容，所有数据都存储在本地，不会上传到任何服务器，可以随时停止监控或清除数据。

系统要求为 macOS 13.0 或更高版本，需要辅助功能权限。

如果你在使用过程中遇到权限弹窗未正常跳转、统计无变化或其他疑问，可以先尝试清空数据或重新授权辅助功能。如果应用无法开始监控，确认已在系统设置中授予辅助功能权限，如果已授予权限但仍然无法工作，尝试取消勾选 TypeTracer 的权限，重新勾选权限，然后重启应用。如果统计数据不准确，点击清除数据按钮重置统计或重启应用。如果找不到辅助功能设置，路径为系统设置、隐私与安全性、辅助功能。

如果需要卸载应用，删除应用程序并到系统设置中移除辅助功能权限。

本工具架构清晰，采用 Model-View-ViewModel 分层，代码全部带有英文注释并保持易读。开发语言为 Swift 5.0，UI 框架为 SwiftUI，最低部署目标为 macOS 13.0，架构模式为 MVVM。核心 API 包括 Accessibility API、NSEvent Global Monitor、UserDefaults 数据持久化和 Combine Framework 响应式编程。

代码结构包括 TypeTracerApp.swift 作为应用入口，ContentView.swift 作为主界面视图，KeyboardMonitor.swift 作为键盘监控逻辑，TypingStatistics.swift 作为统计数据管理，TypeTracer.entitlements 作为权限配置，以及 Assets.xcassets 作为资源文件。

性能考虑方面，使用时间戳数组而非字典减少内存占用，每秒更新一次统计数据平衡实时性和性能，自动清理旧数据防止数据无限增长，使用 weak self 避免内存泄漏。

常见问题包括为什么需要禁用 App Sandbox，这是因为 macOS 的 App Sandbox 会限制应用访问系统级 API，为了监听全局键盘事件，需要使用辅助功能 API，这要求禁用 Sandbox。应用不会记录输入的内容，只记录按键的时间戳，不记录任何按键内容，隐私是安全的。为什么只保存七天的数据，这是为了平衡数据保留和存储空间，如果需要保留更长时间，可以修改 TypingStatistics.swift 中的时间参数。应用支持后台运行，可以通过菜单栏图标常驻，即使主窗口关闭也能继续监控。统计数据不会上传到服务器，所有数据都存储在本地 UserDefaults 中，绝不会上传到任何服务器。

欢迎提出改进意见或反馈使用体验。
