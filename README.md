# TypeTracer - Mac 打字追踪应用

TypeTracer 是一款 macOS 平台的本地打字追踪工具。它适合需要了解和回顾自己每日打字与输入习惯的用户。应用可后台运行，通过菜单栏图标常驻，即使主窗口被关闭，系统依然会自动统计你的按键信息。

应用主要设计目标是帮助你随时了解过去一分钟、一小时，以及当天的打字数量，并以清晰的界面进行统计展示。所有数据会持续保存，并可随时回顾最近七天的历史情况，无需担心数据重启丢失。TypeTracer 不会记录具体按键内容，仅记录数量，保护你的隐私。

<<<<<<< HEAD
软件实现基于 Swift 5 和 SwiftUI，主要分为键盘事件监听、统计模型和可视化界面三部分。全局键盘监听使用 macOS 辅助功能 API，能够精准捕获你的击键行为。统计模型部分会自动存储每次击键时间，并周期性统计近一分钟、一小时、全天，及最近一周的击键数和分布情况。应用界面则为你直观呈现三项核心统计和今日按小时的柱状图，并可以方便地浏览历史记录。
=======
-  **实时监控**：实时追踪键盘按键次数（每秒更新）
-  **多时间维度统计**：
  - 最近一分钟的打字数量
  - 最近一小时的打字数量
  - 今日的打字数量
-  **数据可视化**：
  - 三个彩色统计卡片直观显示数据
  - 每小时打字量的柱状图
  - 最近7天的数据对比条形图
- 📅 **历史记录**：查看最近7天的打字统计数据
- 💾 **数据持久化**：自动保存数据，重启应用后数据不丢失
- 🔒 **隐私保护**：只统计按键次数，不记录具体内容
>>>>>>> 4b7638f4ab660f8ffdc3187083816e10b5efe819

首次运行 TypeTracer，你需要授予辅助功能权限。主界面提供了跳转入口，按照提示即可在系统「隐私与安全性→辅助功能」页面手动添加和勾选 TypeTracer。一旦授权，应用就会在后台自动统计所有击键。

在 Xcode 打开本项目并运行后，窗口下方可主动清空现有数据。你还可以随时将窗口隐藏到菜单栏，仅靠顶部系统栏的图标和菜单完成所有操作。菜单栏图标会实时更新最近一分钟的打字数，点击图标可以查看更多详细数据及快速切换监控、退出等操作。

TypeTracer 的所有数据仅保存在本地 UserDefaults，不会进行网络同步或上传，保证使用过程中的个人隐私安全。

如果你在使用过程中遇到权限弹窗未正常跳转、统计无变化或其他疑问，可以先尝试清空数据或重新授权辅助功能。如仍有问题，建议参考本目录下的常见问题、故障排查说明。

<<<<<<< HEAD
本工具架构清晰，采用Model-View-ViewModel分层，代码全部带有英文注释并保持易读。欢迎提出改进意见或反馈使用体验。
=======
#### 3. ContentView.swift
提供用户界面：
- **实时统计页面**：显示三个统计卡片和每小时柱状图
- **历史数据页面**：显示最近7天的数据对比
- **控制面板**：启动/停止监控、清除数据、权限管理

#### 4. TypeTracer.entitlements
配置应用权限：
- 禁用App Sandbox以允许全局键盘事件监听
- 确保应用能够请求辅助功能权限

### 工作原理

1. **权限获取**：应用需要"辅助功能"权限才能监听全局键盘事件
2. **事件监听**：通过 `NSEvent.addGlobalMonitorForEvents` 监听键盘按下事件
3. **数据记录**：每次按键时记录时间戳到数组中
4. **实时计算**：每秒更新一次统计数据，通过过滤时间戳计算不同时间段的按键数
5. **数据持久化**：将时间戳数组保存到 UserDefaults，应用重启后自动加载

## 配置步骤

### 1. 打开项目

使用 Xcode 打开项目：

```bash
cd /Users/hyc/Documents/Coding/TypeTracer
open TypeTracer.xcodeproj
```

### 2. 构建并运行

1. 在 Xcode 中，确保项目能够正常加载所有文件：
   - KeyboardMonitor.swift
   - TypingStatistics.swift
   - ContentView.swift
   - TypeTracerApp.swift
   - TypeTracer.entitlements
2. 选择目标设备为 "My Mac"
3. 点击运行按钮（或按 `Cmd + R`）
4. 应用将启动并显示主界面

**注意**：首次构建时，Xcode会自动识别新添加的Swift文件。如果遇到文件未识别的问题，请尝试清理构建文件夹（`Product -> Clean Build Folder`）然后重新构建。

### 3. 授予辅助功能权限

**重要步骤**：应用首次运行时会显示"请求辅助功能权限"按钮

1. 点击"请求辅助功能权限"按钮
2. 系统会自动打开"系统设置 > 隐私与安全性 > 辅助功能"
3. 在列表中找到 "TypeTracer"
4. 勾选 TypeTracer 旁边的复选框以授予权限
5. 返回应用，它会自动开始监控

**手动设置路径**：
```
系统设置 → 隐私与安全性 → 辅助功能 → 添加 TypeTracer
```

### 4. 开始使用

权限授予后：
- 应用会自动开始监控键盘输入
- 界面上的状态指示器会显示"正在监控"（绿色圆点）
- 实时数据会开始更新

### 5. 测试应用

为了验证应用是否正常工作：
1. 打开任何文本编辑器（如备忘录、TextEdit）
2. 开始输入一些文字
3. 切换回TypeTracer应用，观察"最近一分钟"的数字是否在增加
4. 继续打字，观察统计数据的实时变化

## 使用说明

### 主界面

应用界面分为以下几个部分：

#### 顶部状态栏
- **TypeTracer** 标题和监控状态指示器
  - 🟢 绿色圆点 = 正在监控
  - 🔴 红色圆点 = 未启动
- **总按键数**：显示自开始记录以来的总按键数量

#### 中间标签切换
使用分段控制器切换两个视图：
- **实时统计**：查看当前的打字数据
- **历史数据**：查看过去7天的数据对比

#### 实时统计页面（第一个标签）
- **三个彩色统计卡片**：
  - 🔵 **最近一分钟**：显示过去60秒内的按键数
  - 🟢 **最近一小时**：显示过去60分钟内的按键数
  - 🟠 **今日**：显示今天0点到现在的按键数
- **每小时统计图表**：
  - 横坐标：0-23小时
  - 纵坐标：按键数量
  - 柱状图实时显示今天每个小时的打字量

#### 历史数据页面（第二个标签）
- 显示最近7天的打字统计
- 每一行包含：
  - 日期（月/日/星期）
  - 可视化条形图
  - 具体数字
- 数据按日期降序排列（今天在最上面）

#### 底部控制栏
- **请求辅助功能权限**按钮（橙色）：
  - 仅在没有权限时显示
  - 点击后会打开系统设置页面
- **清除数据**按钮（灰色）：
  - 清除所有历史统计数据
  - 操作不可撤销，请谨慎使用
- **开始/停止监控**按钮（蓝色）：
  - 手动控制监控的启动和停止
  - 需要先授予辅助功能权限才能启用

### 数据说明

- **数据更新频率**：每秒更新一次
- **数据存储期限**：自动保存最近7天的数据
- **数据存储位置**：UserDefaults（应用沙盒内）
- **重启应用**：数据会自动恢复

## 隐私说明

- 应用**只统计按键次数**，不记录具体按键内容
- 所有数据都**存储在本地**，不会上传到任何服务器
- 可以随时停止监控或清除数据

## 系统要求

- macOS 13.0 或更高版本
- 辅助功能权限

## 故障排除

### 问题：应用无法开始监控
**解决方案**：
1. 确认已在系统设置中授予辅助功能权限
2. 如果已授予权限但仍然无法工作，尝试：
   - 取消勾选 TypeTracer 的权限
   - 重新勾选权限
   - 重启应用

### 问题：统计数据不准确
**解决方案**：
- 点击"清除数据"按钮重置统计
- 重启应用

### 问题：找不到辅助功能设置
**路径**：
```
 → 系统设置 → 隐私与安全性 → 辅助功能
```

## 卸载

如果需要卸载应用：
1. 删除应用程序
2. 到系统设置中移除辅助功能权限

## 技术支持

如有问题或建议，欢迎反馈！

## 开发信息

- **开发语言**：Swift 5.0
- **UI框架**：SwiftUI
- **最低部署目标**：macOS 13.0
- **架构模式**：MVVM（Model-View-ViewModel）
- **核心API**：
  - Accessibility API (AXIsProcessTrusted)
  - NSEvent Global Monitor
  - UserDefaults (数据持久化)
  - Combine Framework (响应式编程)

## 代码结构

```
TypeTracer/
├── TypeTracerApp.swift          # 应用入口
├── ContentView.swift             # 主界面视图
├── KeyboardMonitor.swift         # 键盘监控逻辑
├── TypingStatistics.swift        # 统计数据管理
├── TypeTracer.entitlements       # 权限配置
└── Assets.xcassets/              # 资源文件
```

## 性能考虑

- 使用时间戳数组而非字典，减少内存占用
- 每秒更新一次统计数据，平衡实时性和性能
- 自动清理旧数据，防止数据无限增长
- 使用 `weak self` 避免内存泄漏

## 常见问题

### Q: 为什么需要禁用App Sandbox？
A: macOS的App Sandbox会限制应用访问系统级API。为了监听全局键盘事件，需要使用辅助功能API，这要求禁用Sandbox。

### Q: 应用会记录我输入的内容吗？
A: **不会**。应用只记录按键的时间戳，不记录任何按键内容。您的隐私是安全的。

### Q: 为什么只保存7天的数据？
A: 这是为了平衡数据保留和存储空间。如果需要保留更长时间，可以修改 `TypingStatistics.swift` 中的时间参数。

### Q: 可以在后台运行吗？
A: 当前版本需要应用窗口保持打开。未来版本可以考虑添加菜单栏应用支持。

### Q: 统计数据会上传到服务器吗？
A: **不会**。所有数据都存储在本地UserDefaults中，绝不会上传到任何服务器。

>>>>>>> 4b7638f4ab660f8ffdc3187083816e10b5efe819

