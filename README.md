# TypeTracer - Mac 打字追踪应用

TypeTracer 是一款 macOS 平台的本地打字追踪工具。它适合需要了解和回顾自己每日打字与输入习惯的用户。应用可后台运行，通过菜单栏图标常驻，即使主窗口被关闭，系统依然会自动统计你的按键信息。

应用主要设计目标是帮助你随时了解过去一分钟、一小时，以及当天的打字数量，并以清晰的界面进行统计展示。所有数据会持续保存，并可随时回顾最近七天的历史情况，无需担心数据重启丢失。TypeTracer 不会记录具体按键内容，仅记录数量，保护你的隐私。

## 功能特性

应用提供实时监控功能，每秒更新一次键盘按键统计。你可以查看最近一分钟、最近一小时和今日的打字数量，通过三个彩色统计卡片直观了解自己的输入情况。应用还提供每小时打字量的柱状图，以及最近七天的数据对比条形图，帮助你分析自己的打字习惯和趋势。

所有统计数据会自动保存到本地，重启应用后数据不会丢失。应用支持菜单栏模式，可以隐藏主窗口但继续在后台监控，菜单栏图标会实时显示最近一分钟的打字数，点击图标可以快速查看详细统计和进行各种操作。

## 技术实现

软件基于 Swift 5 和 SwiftUI 开发，采用 Model-View-ViewModel 架构模式。应用主要分为三个核心部分：键盘事件监听、统计模型和可视化界面。

全局键盘监听通过 macOS 辅助功能 API 实现，使用 NSEvent.addGlobalMonitorForEvents 监听键盘按下事件。系统会过滤掉单独的修饰键（Command、Control、Option、Shift），只统计实际的字符输入。每次按键时，系统会记录时间戳到数组中，然后每秒更新一次统计数据，通过过滤时间戳计算不同时间段的按键数。

统计模型负责管理所有打字数据。TypingStatistics.swift 记录每次按键的时间戳，计算不同时间段的统计数据（分钟、小时、天），使用 UserDefaults 持久化存储数据，并自动清理七天以前的旧数据以节省存储空间。数据存储采用时间戳数组而非字典，减少内存占用，同时支持快速时间范围查询。

用户界面由 ContentView.swift 提供，包含实时统计页面显示三个统计卡片和每小时柱状图，历史数据页面显示最近七天的数据对比，以及控制面板用于启动停止监控、清除数据和权限管理。应用使用 Combine Framework 实现响应式数据流，通过 @Published 属性实现实时数据更新。

应用需要禁用 App Sandbox 才能访问系统级 API，这是通过 TypeTracer.entitlements 配置文件实现的。应用会优雅地处理辅助功能权限请求和检查，确保用户能够顺利授权并开始使用。

## 使用方法

### 首次配置

首次运行 TypeTracer 时，你需要授予辅助功能权限。应用主界面提供了跳转入口，点击"请求辅助功能权限"按钮后，系统会自动打开"系统设置 > 隐私与安全性 > 辅助功能"页面。在列表中找到 TypeTracer 并勾选，然后返回应用，系统会自动开始监控。

如果自动跳转没有正常工作，你也可以手动前往系统设置，在隐私与安全性下的辅助功能页面添加 TypeTracer。

### 日常使用

授权完成后，应用会自动开始监控键盘输入。界面上的状态指示器会显示"正在监控"（绿色圆点），实时数据会开始更新。你可以随时查看最近一分钟、最近一小时和今日的打字数量，以及每小时统计图表。

应用支持隐藏主窗口到菜单栏。点击窗口底部的"隐藏到菜单栏"按钮，主窗口会关闭但应用继续在后台运行。菜单栏图标会实时更新最近一分钟的打字数，点击图标可以查看详细统计、切换监控状态或退出应用。

### 数据管理

数据更新频率为每秒一次，系统会自动保存最近七天的数据到 UserDefaults 应用沙盒内。重启应用后，所有数据会自动恢复。如果需要清空所有统计数据，可以点击窗口底部的"清除数据"按钮，这个操作不可撤销，请谨慎使用。

## 隐私与安全

TypeTracer 的所有数据仅保存在本地 UserDefaults，不会进行网络同步或上传，保证使用过程中的个人隐私安全。应用只统计按键次数，不记录具体按键内容，所有数据都存储在本地，不会上传到任何服务器。你可以随时停止监控或清除数据。

## 系统要求

应用需要 macOS 13.0 或更高版本，以及辅助功能权限才能正常工作。

## 故障排除

如果应用无法开始监控，首先确认已在系统设置中授予辅助功能权限。如果已授予权限但仍然无法工作，可以尝试取消勾选 TypeTracer 的权限，重新勾选权限，然后重启应用。

如果统计数据不准确，可以点击"清除数据"按钮重置统计，或者重启应用。如果找不到辅助功能设置，路径为系统设置、隐私与安全性、辅助功能。

如果需要卸载应用，删除应用程序并到系统设置中移除辅助功能权限即可。

## 开发信息

### 技术栈

应用使用 Swift 5.0 开发，UI 框架为 SwiftUI，最低部署目标为 macOS 13.0。核心 API 包括 Accessibility API 用于权限检查，NSEvent Global Monitor 用于全局键盘监听，UserDefaults 用于数据持久化，以及 Combine Framework 用于响应式编程。

### 代码结构

项目代码结构清晰，TypeTracerApp.swift 作为应用入口，ContentView.swift 作为主界面视图，KeyboardMonitor.swift 负责键盘监控逻辑，TypingStatistics.swift 管理统计数据，TypeTracer.entitlements 配置应用权限，Assets.xcassets 包含资源文件。

### 性能优化

应用在性能方面做了多项优化。使用时间戳数组而非字典减少内存占用，每秒更新一次统计数据平衡实时性和性能，自动清理旧数据防止数据无限增长，使用 weak self 避免内存泄漏。代码全部带有英文注释，采用 Model-View-ViewModel 分层架构，保持易读性和可维护性。

## 常见问题

**为什么需要禁用 App Sandbox？** macOS 的 App Sandbox 会限制应用访问系统级 API。为了监听全局键盘事件，需要使用辅助功能 API，这要求禁用 Sandbox。

**应用会记录我输入的内容吗？** 不会。应用只记录按键的时间戳，不记录任何按键内容。你的隐私是安全的。

**为什么只保存七天的数据？** 这是为了平衡数据保留和存储空间。如果需要保留更长时间，可以修改 TypingStatistics.swift 中的时间参数。

**可以在后台运行吗？** 可以。应用支持菜单栏模式，可以通过菜单栏图标常驻，即使主窗口关闭也能继续监控。

**统计数据会上传到服务器吗？** 不会。所有数据都存储在本地 UserDefaults 中，绝不会上传到任何服务器。

---

欢迎提出改进意见或反馈使用体验。
